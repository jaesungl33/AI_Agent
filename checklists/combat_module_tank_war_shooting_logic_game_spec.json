{
  "doc_id": "combat_module_tank_war_shooting_logic",
  "metadata": {
    "created_at": "2025-11-26T10:37:02.141362",
    "version": "1.0",
    "auto_extracted": true
  },
  "spec": {
    "objects": [
      {
        "id": "obj_bullet",
        "name": "Bullet",
        "category": "BR",
        "description": "Kinematic projectile with configurable speed, range, and collision bands.",
        "size_x": null,
        "size_y": null,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": 40,
        "player_pass_through": null,
        "bullet_pass_through": null,
        "destructible": null,
        "special_rules": "Uses Attack Band for collision detection. Can have Multi-Height Sweep and Pitch Assist enabled/disabled based on configuration.",
        "source_note": "BulletProfile table and Shooting Logic description."
      },
      {
        "id": "obj_blocker_low",
        "name": "Low Blocker",
        "category": "BO",
        "description": "Low obstacle that can block bullets within specified height range.",
        "size_x": null,
        "size_y": 1.1,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": null,
        "player_pass_through": null,
        "bullet_pass_through": false,
        "destructible": null,
        "special_rules": "Tagged as Wall_Low. Uses Hit Band for collision detection.",
        "source_note": "Level Design Guideline and Tags section."
      },
      {
        "id": "obj_blocker_high",
        "name": "High Blocker",
        "category": "BO",
        "description": "High obstacle that can block bullets within specified height range.",
        "size_x": null,
        "size_y": null,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": null,
        "player_pass_through": null,
        "bullet_pass_through": false,
        "destructible": null,
        "special_rules": "Tagged as Wall_High. Uses Hit Band for collision detection.",
        "source_note": "Level Design Guideline and Tags section."
      },
      {
        "id": "obj_fence_thin",
        "name": "Thin Fence",
        "category": "BO",
        "description": "Thin railing or fence that can block bullets within specified height range.",
        "size_x": null,
        "size_y": 1.2,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": null,
        "player_pass_through": null,
        "bullet_pass_through": false,
        "destructible": null,
        "special_rules": "Tagged as Fence_Thin. Uses Hit Band for collision detection.",
        "source_note": "Level Design Guideline and Tags section."
      },
      {
        "id": "obj_shield",
        "name": "Shield",
        "category": "BO",
        "description": "Special blocker that always blocks bullets and requires special ammunition or skills to penetrate.",
        "size_x": null,
        "size_y": null,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": null,
        "player_pass_through": null,
        "bullet_pass_through": false,
        "destructible": null,
        "special_rules": "Tagged as Shield. Always blocks bullets and displays energy impact FX.",
        "source_note": "Shooting Logic description and Special Rules section."
      },
      {
        "id": "obj_vegetation",
        "name": "Vegetation",
        "category": "BO",
        "description": "Environmental element that typically does not block bullets unless specifically tagged as a blocker.",
        "size_x": null,
        "size_y": null,
        "size_z": null,
        "hp": null,
        "armor": null,
        "speed": null,
        "player_pass_through": null,
        "bullet_pass_through": true,
        "destructible": null,
        "special_rules": "Tagged as NonBlock_Vegetation by default. Can be overridden with Blocker tag for special cases.",
        "source_note": "Level Design Guideline and Tags section."
      }
    ],
    "systems": [
      {
        "id": "sys_collision_band",
        "name": "2.5D Collision Band System",
        "description": "Default system for handling bullet collision detection using Attack Band and Hit Band overlap.",
        "mechanics": "Performs Sphere/Capsule Cast each frame along bullet trajectory. Checks for Y-band overlap between bullet and colliders.",
        "objectives": "Ensure accurate and fair hit detection while maintaining performance.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "interactions": [
          "Logic rule for HIT determination based on Y-band overlap."
        ],
        "source_note": "Lớp A — 2.5D Collision Band description."
      },
      {
        "id": "sys_multi_height_sweep",
        "name": "Multi-Height Sweep System",
        "description": "Optional system performing additional sweeps at multiple heights to detect low obstacles.",
        "mechanics": "Casts rays/sweeps at predefined heights (groundY + offsets) when firing. Prioritizes earlier hits over straight trajectory.",
        "objectives": "Improve hit accuracy for maps with many low obstacles or gaps.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_fence_thin"
        ],
        "interactions": [
          "Logic rule for prioritizing sweep-detected hits."
        ],
        "source_note": "Lớp B — Multi-Height Sweep description."
      },
      {
        "id": "sys_pitch_assist",
        "name": "Smart Pitch Assist System",
        "description": "Optional system adjusting bullet pitch slightly before spawning to reduce near misses.",
        "mechanics": "Adjusts pitch within ±3° before bullet spawn if a low blocker is detected in the immediate range.",
        "objectives": "Reduce frustrating near misses without implementing auto-aim.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low"
        ],
        "interactions": [
          "Logic rule for pitch adjustment based on blocker detection."
        ],
        "source_note": "Lớp C — Smart Pitch Assist description."
      }
    ],
    "logic_rules": [
      {
        "id": "rule_hit_detection",
        "summary": "Determine HIT based on Y-band overlap.",
        "description": "If Attack Band of bullet overlaps with Hit Band of collider (including yForgiveness), register as HIT.",
        "trigger": "Sphere/Capsule Cast detects collider intersection during bullet flight.",
        "effect": "Register HIT event and apply corresponding effects (VFX, SFX, damage).",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-1 and Lớp A — 2.5D Collision Band description."
      },
      {
        "id": "rule_sweep_priority",
        "summary": "Prioritize sweep-detected hits over straight trajectory.",
        "description": "If Multi-Height Sweep detects a hit earlier than straight trajectory, prioritize the sweep-detected position for blocking.",
        "trigger": "Multi-Height Sweep detects an obstacle closer than straight trajectory.",
        "effect": "Adjust bullet trajectory to collide with the detected obstacle.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_fence_thin"
        ],
        "related_systems": [
          "sys_multi_height_sweep"
        ],
        "source_note": "Lớp B — Multi-Height Sweep description."
      },
      {
        "id": "rule_pitch_adjustment",
        "summary": "Adjust bullet pitch to avoid near misses.",
        "description": "Before spawning bullet, adjust pitch slightly (≤3°) if a low blocker is detected within 2–6 meters.",
        "trigger": "Detection of low blocker within specified range before firing.",
        "effect": "Modify bullet spawn angle to reduce likelihood of near misses.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low"
        ],
        "related_systems": [
          "sys_pitch_assist"
        ],
        "source_note": "Lớp C — Smart Pitch Assist description."
      }
    ],
    "requirements": [
      {
        "id": "req_fr_1",
        "title": "Block Bullet on XZ Overlap with Collider",
        "description": "Bullet should be blocked when its XZ path intersects with a collider belonging to the Blocker Category and Attack Band overlaps Hit Band of the object.",
        "category": "combat",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "Bullet is blocked when conditions are met; otherwise, it continues flight.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-1 description."
      },
      {
        "id": "req_fr_2",
        "title": "Apply yForgiveness for Both Bullet and Obstacle",
        "description": "Include yForgiveness margin for both bullet and obstacle in hit detection calculations.",
        "category": "combat",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "Hits are registered even if Y-band overlap occurs within yForgiveness margin.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-2 description."
      },
      {
        "id": "req_fr_3",
        "title": "Enable/Disable Multi-Height Sweep and Pitch Assist",
        "description": "Allow enabling or disabling Multi-Height Sweep and Smart Pitch Assist based on map or mode settings.",
        "category": "combat",
        "priority": "medium",
        "status": "proposed",
        "acceptance_criteria": "Features can be toggled via configuration without affecting core functionality.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_multi_height_sweep",
          "sys_pitch_assist"
        ],
        "source_note": "FR-3 description."
      },
      {
        "id": "req_fr_4",
        "title": "Class-Specific Band Presets",
        "description": "Provide preset configurations for bandUp and bandDown per class (Scout/Assault/Heavy).",
        "category": "combat",
        "priority": "medium",
        "status": "proposed",
        "acceptance_criteria": "Each class has unique bandUp and bandDown values applied correctly.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-4 description and ClassProfile table."
      },
      {
        "id": "req_fr_5",
        "title": "Respect Team Filtering",
        "description": "Do not register hits on teammates unless friendly fire is enabled.",
        "category": "combat",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "Bullets do not hit teammates unless explicitly allowed by design.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-5 description."
      },
      {
        "id": "req_fr_6",
        "title": "End-of-Range Behavior",
        "description": "When bullet reaches maximum range, trigger distinct VFX and remove bullet.",
        "category": "combat",
        "priority": "medium",
        "status": "proposed",
        "acceptance_criteria": "Distinct VFX plays and bullet disappears upon reaching maximum range.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-6 description."
      },
      {
        "id": "req_fr_7",
        "title": "Material-Specific VFX",
        "description": "Trigger different VFX based on surface material (metal, dirt, rock, wood, shield).",
        "category": "combat",
        "priority": "medium",
        "status": "proposed",
        "acceptance_criteria": "Correct VFX plays based on impacted surface material.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "related_systems": [
          "sys_collision_band"
        ],
        "source_note": "FR-7 description."
      },
      {
        "id": "req_nfr_perf",
        "title": "Performance Constraint for Shape Casting",
        "description": "Limit shape casting to ≤1 cast/frame/bullet by default. If Multi-Height Sweep is enabled, total casts ≤3 at initiation.",
        "category": "tech",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "System adheres to casting limits without compromising functionality.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band",
          "sys_multi_height_sweep"
        ],
        "source_note": "NFR-Perf description."
      },
      {
        "id": "req_nfr_data",
        "title": "Data-Driven Configuration",
        "description": "Allow all parameters to be configured via ScriptableObject (BulletProfile, ClassProfile, MapProfile).",
        "category": "tech",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "All relevant parameters can be adjusted through ScriptableObjects.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band",
          "sys_multi_height_sweep",
          "sys_pitch_assist"
        ],
        "source_note": "NFR-Data description."
      },
      {
        "id": "req_nfr_ux",
        "title": "Minimize Perceived Misses",
        "description": "Ensure perceived hit mismatch rate is <5% during playtesting.",
        "category": "ux",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "Telemetry shows perceived hit mismatch rate below 5%.",
        "related_objects": [
          "obj_bullet"
        ],
        "related_systems": [
          "sys_collision_band",
          "sys_multi_height_sweep",
          "sys_pitch_assist"
        ],
        "source_note": "NFR-UX description."
      },
      {
        "id": "req_nfr_qa",
        "title": "QA Test Matrix",
        "description": "Provide a test matrix with pass/fail criteria for validating shooting logic.",
        "category": "qa",
        "priority": "high",
        "status": "proposed",
        "acceptance_criteria": "Test matrix covers all scenarios with clear pass/fail criteria.",
        "related_objects": [
          "obj_bullet",
          "obj_blocker_low",
          "obj_blocker_high",
          "obj_fence_thin",
          "obj_shield",
          "obj_vegetation"
        ],
        "related_systems": [
          "sys_collision_band",
          "sys_multi_height_sweep",
          "sys_pitch_assist"
        ],
        "source_note": "NFR-QA description and QA Test Matrix table."
      }
    ]
  }
}